# コーパスについて

このディレクトリに含まれるコーパスは Public Domain です。
追加したい場合は、自分が著作権をもっている文章をコーパスとして登録することができます。
Pull-Request を出していただければマージします。

コーパスファイルに書かれた単語はかな漢字辞書にも自動的に登録されますので、基本的にはこのファイルに Pull-Request を送ってください。

## ファイル種別

- must.txt - 必ず変換できなくてはならないもの。これが全部変換できないと出荷基準を満たさないと判断されます。
- should.txt - 変換できてほしいもの。基本的にはここに PR を送ってください。
- may.txt - これが変換できてほしいなぁというもの。たぶんできないだろうなぁという程度のものも登録して OK

## 作り方

    akaza-data tokenize-line --system-dict work/vibrato/ipadic-mecab-2_7_0/system.dic 私の名前は中野です

のようにすると

    私/わたし の/の 名前/なまえ は/は 中野/なかの です/です

のように出力されます。これを修正して追加すれば良いです。

複数行をまとめて変換する場合は、stdin から流し込めます:

    cat sentences.txt | akaza-data tokenize-line --system-dict work/vibrato/ipadic-mecab-2_7_0/system.dic

tokenize-line の読みが間違っていることがあるので、出力は必ず目視で確認してください。
よくある誤りの例:

- `行っ/おこなっ` → 「いっ」が正しい場合は `行っ/いっ` に修正
- `降りそう/おりそう` → 「ふりそう」が正しい場合は `降りそう/ふりそう` に修正

## 効果的なエントリの選び方

Akaza は bigram（2-gram）ベースの統計的かな漢字変換エンジンです。
コーパスのエントリは直前の1単語との共起関係（bigram）としてモデルに学習されます。
この仕組みを理解した上で、効果の高いエントリを優先的に追加してください。

### 効果が高いもの

- **Wikipedia・青空文庫に出にくい日常表現** — 学習データの主なソースは Wikipedia と青空文庫なので、口語・会話体の表現はカバーが薄い。「お疲れ様です」「忙しくてさ」「間に合うかな」のような日常的な文は効果が大きい。
- **直前の語で確定できる共起パターン** — bigram と相性が良い。例: 「板/いた が/が 厚い/あつい」「お湯/おゆ が/が 熱い/あつい」のように、直前の名詞で同音異義語が確定するケース。
- **定型的なビジネス表現** — 「お手数をおかけします」「承知しました」など、Wikipedia には出にくいが日常的に入力する表現。
- **新語・固有名詞を含む文** — Wikipedia に掲載されるまで時間がかかる語。コーパスに文脈ごと追加することで辞書登録と bigram 学習を同時に行える。

### 効果が限定的なもの

- **同音異義語の文脈判別** — bigram モデルでは直前の1単語しか参照できないため、文全体の意味で決まるような同音異義語の判別には原理的な限界がある。例えば「期間が長い」vs「機関が動く」は直前の語で区別できるが、「関心を持つ」vs「感心を持つ」のように直前の助詞パターンが同じ場合は効果が薄い。
- **純粋にひらがなだけの文** — 「やっぱりそうだよね」のようにかな漢字変換が発生しない文は、bigram 統計には寄与するが優先度は低い。

### コーパス以外のチューニングポイント

誤変換の原因は複数あり、コーパス追加だけでは対応できないケースもあります。
原因に応じて適切なツールを使い分けてください。

#### training-corpus/*.txt（bigram スコア調整）

最も基本的なチューニング。unigram/bigram のスコアを変化させ、変換候補の優先順位を変える。
コーパスに書かれた単語は自動的にかな漢字辞書にも登録される（delta=2000）。

- 同音異義語の文脈判別（直前の語で区別できるもの）
- IME 実行時の分節解析が崩壊するケース（正しい分節のスコアを補強）
- SKK-JISYO.L に存在する誤候補の抑制（例: `ましょう /魔性/` に対して、コーパスでひらがな ましょう のスコアを上げる）

#### mecab-user-dict.csv（Vibrato トークン化の修正）

Vibrato（MeCab 互換）の user dictionary。**訓練時のトークン化**に影響する。
Vibrato が未知語として扱う単語や、分割を誤る複合語を登録する。

```
表層形,左文脈ID,右文脈ID,コスト,品詞,品詞細分類1,品詞細分類2,品詞細分類3,活用型,活用形,原形,読み,発音
```

使いどころ:
- 新語・固有名詞が Vibrato で正しくトークン化されない場合
- Wikipedia/青空文庫の訓練データで特定の語が正しく切り出されない場合
- **注意**: IME 実行時の分節解析には直接影響しない（訓練統計の改善を通じて間接的に影響）

#### dict/SKK-JISYO.akaza（システム辞書の補完）

SKK-JISYO.L に含まれない語彙を追加する辞書。IME 実行時の変換候補に直接影響する。

```
よみ /候補1/候補2/
```

使いどころ:
- SKK-JISYO.L に含まれない新語・固有名詞・専門用語
- SKK-JISYO.L に含まれない読みバリアント
- **注意**: SKK-JISYO.L に既にある語を上書きすることはできない

### 対応を断念したパターン

以下は現状のモデル構造では修正が困難と判断したパターンです。

- **文末の意志形「しよう」→「使用」** — 「だらだらしよう」「見なかったことにしよう」など。SKK-JISYO.L に `しよう /使用/仕様/試用/私用/...` と多数の漢字候補があり、直前の語がさまざまなので bigram では汎用的に抑制できない。
- **終止形の「飼う」→「買う」** — 「猫を飼う」→「猫を買う」。直前の助詞「を」が同じため bigram では区別不能。「飼っている」形なら修正済み。
- **「乗務員まで」→「乗務員間で」** — 「まで」が「間+で」に分節される。
- **「一日中」（いちにちじゅう）→「一日十」** — SKK-JISYO.L に `いちにちじゅう /一日中/` は存在するが、IME の分節解析が `いちにち+じゅう` を優先する。コーパスでスコアを補強しても分節スコアに負ける。
- **「我ながら」→「我乍ら」** — 稀な漢字表記が選択される。頻度の問題だが単体では修正効果が薄い。
- **「あんな」→「アンナ」** — カタカナ語（人名）が優先されるケース。

### LLM を使ったコーパス生成

LLM（ChatGPT、Claude 等）で日本語の文を大量に生成し、tokenize-line でコーパス形式に変換する方法が効率的です。
LLM 生成文は著作権の問題がなく Public Domain として扱えます。

手順:

1. LLM に自然な日本語文をカテゴリ指定で生成させる（口語、ビジネス、季節の挨拶など）
2. `akaza-data tokenize-line` でコーパス形式に変換する
3. 読みの誤りを目視で修正する（上記「作り方」参照）
4. should.txt に追加する

